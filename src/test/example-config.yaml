apiVersion: enonic.cloud/v1alpha1
kind: XPDeployment
metadata:
  name: mycloud-myproject-xp-qa
spec:
  cloud: mycloud
  project: myproject
  name: qa

  xpVersion: 7.1.1
  enabled: true

  sharedDisks:
    blob: 1Gi
    snapshots: 1Gi

  nodes:
    - alias: main
      replicas: 3
      type: ["MASTER", "DATA", "FRONTEND"]
      resources:
        cpu: "1"
        memory: 1Gi
        disks:
          index: 1Gi
      env:
        JAVA_OPTS: |
          -Dcom.sun.management.jmxremote
          -Dcom.sun.management.jmxremote.port=3000
          -Dcom.sun.management.jmxremote.rmi.port=3001
          -Dcom.sun.management.jmxremote.ssl=false
          -Dcom.sun.management.jmxremote.authenticate=false
          -Djava.rmi.server.hostname=127.0.0.1
          -Xdebug
          -Xnoagent
          -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=*:5005
        XP_APPS: |
          com.enonic.app.snapshotter:2.1.1
      config:
        system.properties: |-
          xp.suPassword = {sha512}5b722b307fce6c944905d132691d5e4a2214b7fe92b738920eb3fce3a90420a19511c3010a0e7712b054daef5b57bad59ecbd93b3280f210578f547f4aed4d25
          xp.init.adminUserCreation = false
        com.enonic.xp.app.main.cfg: |
          tourDisabled = true
        com.enonic.xp.web.vhost.cfg: |
          mapping.admin.host = company.com
          mapping.admin.source = /admin
          mapping.admin.target = /admin
          mapping.admin.idProvider.system = default
        logback.xml: |
          <?xml version="1.0"?>
          <configuration scan="true" scanPeriod="60 seconds">

            <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
              <file>${xp.home}/logs/server.log</file>
              <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
                <fileNamePattern>${xp.home}/logs/server.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
                <maxFileSize>100MB</maxFileSize>
                <maxHistory>7</maxHistory>
                <totalSizeCap>3GB</totalSizeCap>
              </rollingPolicy>
              <encoder>
                <pattern>%d{HH:mm:ss.SSS} %-5level %logger{36} - %msg%n</pattern>
              </encoder>
            </appender>

            <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
              <encoder>
                <pattern>%date{ISO8601} %-5level %logger{36} - %msg%n</pattern>
              </encoder>
            </appender>

            <root level="info">
              <appender-ref ref="STDOUT"/>
              <appender-ref ref="FILE"/>
            </root>

            <logger name="org.elasticsearch" additivity="false">
              <level value="DEBUG"/>
              <appender-ref ref="STDOUT"/>
              <appender-ref ref="FILE"/>
            </logger>

          </configuration>

  vHostCertificates:
    company.com:
      selfSigned: true